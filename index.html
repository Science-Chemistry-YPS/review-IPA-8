<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Pacuan Kuda IPA Kelas 8</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Konfigurasi Dasar dan Font */
        body {
            font-family: 'Poppins', sans-serif;
            background: #1f2937; /* Darker background for contrast */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin: 0;
        }
        
        /* Kontainer Utama - Full Screen */
        .game-container {
            width: 100%;
            height: 100vh;
            background: #ffffff;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }

        /* Layout Utama Kuis (Soal & Lomba) */
        .quiz-main-layout {
            display: flex;
            flex-grow: 1; 
            overflow: hidden; 
        }
        
        /* Area Soal (Kiri) - Lebih besar dan fokus di tengah */
        .quiz-area-wrapper {
            width: 65%;
            padding: 40px;
            overflow-y: auto;
            background-color: #f8fafc; 
            border-right: 2px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
        }

        /* Kartu Soal */
        #quiz-area {
            width: 100%;
            max-width: 900px; 
            padding: 30px;
            background-color: #ffffff; 
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: 4px solid #4f46e5;
        }

        /* Area Game (Kanan) - Kontainer lintasan pacuan */
        .game-area-wrapper {
            width: 35%;
            padding: 30px 20px;
            background: linear-gradient(to bottom, #d1f7c4, #8bc34a); /* Gradient Hijau Padang Rumput */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Fokus di tengah secara vertikal */
            border-left: 2px solid #7cb342;
        }
        
        /* LINTASAN PACUAN KUDA */
        .race-track-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Batasi lebar untuk tampilan desktop */
            height: 100px; /* Tinggi lintasan */
            margin: 20px 0;
            background-color: #aed581; /* Warna track */
            border-radius: 10px;
            border: 4px dashed #689f38; /* Garis batas */
            display: flex;
            align-items: center;
        }

        .horse-racer {
            position: absolute;
            top: 50%;
            /* Menggunakan transform X untuk memastikan posisi kuda dihitung dari tengah/kiri, 
               dan tidak keluar dari track pada 100% */
            transform: translateY(-50%); 
            transition: left 1s cubic-bezier(0.25, 1, 0.5, 1.2); /* Animasi gerak kuda */
            width: 80px; 
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            z-index: 10;
        }

        .start-line, .finish-line {
            position: absolute;
            top: 0;
            height: 100%;
            width: 5px;
            background-color: #424242;
            z-index: 5;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }

        .start-line {
            left: 0;
            background: repeating-linear-gradient(90deg, #fff, #fff 5px, #424242 5px, #424242 10px);
            opacity: 0.8;
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        
        .finish-line {
            right: 0;
            background: repeating-linear-gradient(90deg, #fff, #fff 5px, #ffb300 5px, #ffb300 10px);
            opacity: 0.9;
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }

        /* Pilihan Jawaban */
        .quiz-option {
            transition: all 0.2s;
            background-color: #eef2ff; 
            color: #312e81;
            font-weight: 700;
            border: 1px solid #c7d2fe;
            font-size: 1.1rem;
        }
        .quiz-option:hover {
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            background-color: #c7d2fe;
        }

        /* Feedback CSS */
        .option-correct {
            background-color: #10b981 !important; 
            color: white;
            animation: flash-correct 0.5s 1;
        }
        .option-wrong {
            background-color: #f87171 !important; 
            color: white;
            animation: shake 0.5s 1;
        }
        @keyframes shake { 0% { transform: translateX(0); } 20% { transform: translateX(-5px); } 40% { transform: translateX(5px); } 60% { transform: translateX(-5px); } 80% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        
        /* Confetti Styles (Sama seperti sebelumnya) */
        .confetti {
            position: fixed;
            z-index: 1000;
            top: -10px;
            width: 10px;
            height: 10px;
            opacity: 0;
            pointer-events: none;
            border-radius: 2px;
            transform: rotate(var(--rotation)) translate3d(var(--x), var(--y), 0);
            animation: fall 3s ease-in forwards;
        }

        /* Responsiveness */
        @media (max-width: 1024px) {
            .game-container {
                height: auto;
                min-height: 100vh;
            }
            .quiz-main-layout {
                flex-direction: column;
            }
            .quiz-area-wrapper, .game-area-wrapper {
                width: 100%;
                padding: 20px;
                border-right: none;
            }
            .game-area-wrapper {
                height: 250px; 
            }
            .race-track-container {
                height: 70px;
                max-width: 90%;
            }
            .horse-racer {
                width: 50px;
                height: 50px;
                font-size: 32px;
            }
        }
    </style>
</head>
<body>

<div id="app" class="game-container">
    <!-- Konten akan dimuat oleh JavaScript -->
</div>

<script>
    // Data Soal (Simbol Matematika sudah Dihilangkan dan Diganti dengan Teks Biasa/Unicode)
    const originalQuestions = [
        // Total 50 Soal
        { q: "Energi panas yang berpindah dari benda bersuhu tinggi ke suhu rendah disebut...", options: ["Usaha", "Energi Potensial", "Daya", "Kalor"], answer: "Kalor", topic: "Kalor (Konsep)" },
        { q: "Proses perpindahan kalor pada air yang mendidih dalam panci adalah...", options: ["Konduksi", "Radiasi", "Adveksi", "Konveksi"], answer: "Konveksi", topic: "Kalor (Konsep)" },
        { q: "Perubahan wujud dari cair menjadi gas di seluruh bagian zat cair disebut...", options: ["Mengembun", "Mencair", "Menguap", "Mendidih"], answer: "Mendidih", topic: "Kalor (Konsep)" },
        { q: "Zat yang memiliki kemampuan baik untuk menghantarkan panas disebut...", options: ["Isolator", "Semikonduktor", "Konduktor", "Resistor"], answer: "Konduktor", topic: "Kalor (Konsep)" },
        { q: "Pada saat es batu berubah menjadi air (mencair), suhu benda...", options: ["Menurun drastis", "Terus meningkat", "Tetap (0¬∞C)", "Tidak tentu"], answer: "Tetap (0¬∞C)", topic: "Kalor (Konsep)" },
        { q: "Berikut yang merupakan contoh perpindahan kalor secara radiasi adalah...", options: ["Pegangan panci menjadi panas", "Air mendidih", "Terjadinya angin laut", "Panas Matahari sampai ke Bumi"], answer: "Panas Matahari sampai ke Bumi", topic: "Kalor (Konsep)" },
        { q: "Kalor jenis (c) menunjukkan banyaknya kalor yang diperlukan untuk menaikkan suhu...", options: ["Seluruh massa benda", "1 kg benda", "1 kg benda sebesar 1¬∞C", "Seluruh massa benda sebesar 1¬∞C"], answer: "1 kg benda sebesar 1¬∞C", topic: "Kalor (Konsep)" },
        { q: "Perpindahan kalor yang terjadi pada saat ujung sendok dicelupkan ke air panas adalah...", options: ["Radiasi", "Konveksi", "Konduksi", "Absorpsi"], answer: "Konduksi", topic: "Kalor (Konsep)" },
        { q: "Ketika terjadi kesetimbangan termal antara dua benda, maka...", options: ["Kalor jenisnya sama", "Massa jenisnya sama", "Energinya sama", "Suhunya sama"], answer: "Suhunya sama", topic: "Kalor (Konsep)" },
        { q: "Dua benda bersentuhan dan mencapai suhu yang sama. Ini menunjukkan bahwa perpindahan ____ telah berhenti.", options: ["Massa", "Energi Potensial", "Usaha", "Kalor"], answer: "Kalor", topic: "Kalor (Konsep)" },

        { q: "Usaha didefinisikan sebagai hasil perkalian antara gaya dengan...", options: ["Waktu", "Kecepatan", "Perpindahan", "Massa"], answer: "Perpindahan", topic: "Usaha & Energi (Konsep)" },
        { q: "Energi yang dimiliki benda karena kedudukannya/ketinggiannya disebut...", options: ["Energi Kinetik", "Energi Mekanik", "Energi Panas", "Energi Potensial"], answer: "Energi Potensial", topic: "Usaha & Energi (Konsep)" },
        { q: "Seorang guru membawa tas dan berjalan mendatar. Usaha oleh gaya angkat tangan terhadap tas adalah nol karena...", options: ["Tidak ada gaya", "Kecepatannya konstan", "Gaya sejajar perpindahan", "Gaya tegak lurus perpindahan"], answer: "Gaya tegak lurus perpindahan", topic: "Usaha & Energi (Konsep)" },
        { q: "Satuan dari Usaha (W) dan Energi (E) dalam SI adalah...", options: ["Newton", "Watt", "Pascal", "Joule"], answer: "Joule", topic: "Usaha & Energi (Konsep)" },
        { q: "Dalam Hukum Kekekalan Energi Mekanik, Ek benda akan bertambah jika...", options: ["Ep bertambah", "Kecepatan berkurang", "Ketinggian bertambah", "Ketinggian berkurang"], answer: "Ketinggian berkurang", topic: "Usaha & Energi (Konsep)" },
        { q: "Energi yang dimiliki benda karena geraknya disebut...", options: ["Energi Potensial", "Energi Mekanik", "Energi Listrik", "Energi Kinetik"], answer: "Energi Kinetik", topic: "Usaha & Energi (Konsep)" },
        { q: "Berapakah Usaha yang dilakukan jika sebuah benda didorong dengan gaya 5 N namun tidak berpindah?", options: ["5 J", "2 J", "1 J", "0 J"], answer: "0 J", topic: "Usaha & Energi (Konsep)" },
        { q: "Pada gerak bandul, energi kinetik maksimum terjadi saat bandul berada di...", options: ["Titik tertinggi", "Titik paling rendah", "Setengah ketinggian", "Posisi awal"], answer: "Titik paling rendah", topic: "Usaha & Energi (Konsep)" },
        { q: "Jika kecepatan benda menjadi dua kali lipat, maka energi kinetiknya akan menjadi...", options: ["Dua kali lipat", "Setengah kali lipat", "Empat kali lipat", "Tidak berubah"], answer: "Empat kali lipat", topic: "Usaha & Energi (Konsep)" },
        { q: "Manakah yang memiliki usaha paling besar?", options: ["Gaya 10 N, pindah 5 m (50 J)", "Gaya 20 N, pindah 2 m (40 J)", "Gaya 5 N, pindah 10 m (50 J)", "Gaya 15 N, pindah 4 m (60 J)"], answer: "Gaya 15 N, pindah 4 m (60 J)", topic: "Usaha (Perhitungan)" }, 

        { q: "Gerak Lurus Beraturan (GLB) dicirikan oleh...", options: ["Percepatan konstan", "Kecepatan berubah", "Percepatan nol", "Percepatan maksimum"], answer: "Percepatan nol", topic: "Gerak & Gaya (Konsep)" },
        { q: "Gerak Lurus Berubah Beraturan (GLBB) dicirikan oleh...", options: ["Kecepatan nol", "Kecepatan konstan", "Gaya nol", "Percepatan konstan"], answer: "Percepatan konstan", topic: "Gerak & Gaya (Konsep)" },
        { q: "Berikut ini yang merupakan contoh GLBB dipercepat adalah...", options: ["Mobil direm", "Bola menggelinding datar", "Buah jatuh dari pohon", "Pesawat terbang stabil"], answer: "Buah jatuh dari pohon", topic: "Gerak & Gaya (Konsep)" },
        { q: "Gaya yang arahnya selalu berlawanan dengan arah gerak benda disebut...", options: ["Gaya Normal", "Gaya Berat", "Gaya Gravitasi", "Gaya Gesek"], answer: "Gaya Gesek", topic: "Gerak & Gaya (Konsep)" },
        { q: "Gaya gesek yang bekerja saat benda sudah bergerak disebut gaya gesek...", options: ["Statis", "Normal", "Berat", "Kinetis"], answer: "Kinetis", topic: "Gerak & Gaya (Konsep)" },
        { q: "Nilai koefisien gesek statis (Œºs) selalu lebih ____ daripada koefisien gesek kinetis (Œºk).", options: ["Kecil", "Sama", "Besar", "Berlawanan"], answer: "Besar", topic: "Gerak & Gaya (Konsep)" },
        { q: "Jika sebuah benda bergerak, dan resultan gaya yang bekerja padanya adalah nol, maka benda bergerak...", options: ["Dipercepat", "Diperlambat", "Konstan (GLB)", "Diam"], answer: "Konstan (GLB)", topic: "Gerak & Gaya (Konsep)" },
        { q: "Gerak mobil yang sedang direm hingga berhenti adalah contoh dari...", options: ["GLB", "GLBB Dipercepat", "GLBB Diperlambat", "Gerak Melingkar"], answer: "GLBB Diperlambat", topic: "Gerak & Gaya (Konsep)" },
        { q: "Dalam GLB, grafik kecepatan (v) terhadap waktu (t) berbentuk...", options: ["Garis lurus miring", "Parabola ke atas", "Parabola ke bawah", "Garis lurus horizontal"], answer: "Garis lurus horizontal", topic: "Gerak & Gaya (Konsep)" },
        { q: "Faktor utama yang mempengaruhi besar kecilnya gaya gesek antara dua permukaan adalah...", options: ["Kecepatan benda", "Massa jenis benda", "Kekasaran permukaan", "Volume benda"], answer: "Kekasaran permukaan", topic: "Gerak & Gaya (Konsep)" },

        { q: "Sebuah balok kayu massanya 2 kg diletakkan pada ketinggian 5 m dari tanah. Jika g=10 m/s¬≤, berapa Energi Potensialnya (Rumus Ep=mgh)?", options: ["10 J", "20 J", "50 J", "100 J"], answer: "100 J", topic: "Energi Potensial (Perhitungan)" }, 
        { q: "Untuk menaikkan suhu 2 kg besi dari 30¬∞C menjadi 80¬∞C (‚àÜT=50¬∞C) dibutuhkan kalor. Jika kalor jenis besi (c) adalah 460 J/kg¬∞C, berapa kalor (Rumus Q=mc‚àÜT) yang dibutuhkan?", options: ["23.000 J", "46.000 J", "92.000 J", "100.000 J"], answer: "46.000 J", topic: "Kalor (Perhitungan)" }, 
        { q: "Seorang atlet menendang bola 0,5 kg sehingga bergerak dengan kecepatan 10 m/s. Berapakah Energi Kinetik (Rumus Ek = ¬Ω m v¬≤) bola tersebut?", options: ["5 J", "10 J", "25 J", "50 J"], answer: "25 J", topic: "Energi Kinetik (Perhitungan)" }, 
        { q: "Sebuah benda awalnya diam (V0=0), kemudian dipercepat (a) 4 m/s¬≤. Berapa kecepatan akhir (Vt) setelah 5 detik (t)?", options: ["5 m/s", "10 m/s", "20 m/s", "40 m/s"], answer: "20 m/s", topic: "GLBB (Perhitungan)" }, 
        { q: "Ani memindahkan lemari dengan gaya dorong 200 N. Lemari berpindah 5 meter. Jika ada gaya gesek 50 N, berapa Usaha total (Rumus W = (Fdorong - Fgesek) x s) yang dilakukan?", options: ["1000 J", "750 J", "250 J", "50 J"], answer: "750 J", topic: "Usaha (Perhitungan)" }, 
        { q: "Mobil bergerak dengan kecepatan (V) 72 km/jam (20 m/s). Berapa jarak (s) yang ditempuh mobil tersebut dalam waktu (t) 10 menit (600 s)?", options: ["7,2 km", "10 km", "12 km", "72 km"], answer: "12 km", topic: "GLB (Perhitungan)" }, 
        { q: "Satu kilogram es bersuhu 0¬∞C dipanaskan. Jika kalor lebur es adalah 336.000 J/kg, berapa kalor yang dibutuhkan untuk melebur seluruh es?", options: ["33.600 J", "336.000 J", "672.000 J", "3.360.000 J"], answer: "336.000 J", topic: "Kalor Lebur (Perhitungan)" }, 
        { q: "Seorang pekerja mengangkat beban 50 kg setinggi 2 meter selama 4 detik. Jika g=10 m/s¬≤, berapa daya (Rumus P=W/t) yang dikeluarkan?", options: ["100 W", "250 W", "500 W", "1000 W"], answer: "250 W", topic: "Daya (Perhitungan)" }, 
        { q: "Sebuah benda bermassa 10 kg didorong dengan gaya 30 N. Tentukan percepatan (Rumus a=F/m) yang dialami benda tersebut!", options: ["1 m/s¬≤", "2 m/s¬≤", "3 m/s¬≤", "30 m/s¬≤"], answer: "3 m/s¬≤", topic: "Hukum Newton (Perhitungan)" }, 
        { q: "Berapa kalor (Rumus Q=mc‚àÜT) yang diperlukan untuk memanaskan 0,5 kg minyak (c=1900 J/kg¬∞C) sebesar 10¬∞C?", options: ["950 J", "1900 J", "9500 J", "19.000 J"], answer: "9500 J", topic: "Kalor (Perhitungan)" }, 
        
        { q: "Sebuah motor bergerak GLB 15 m/s selama 10 s. Jarak tempuhnya (Rumus s=V x t) adalah...", options: ["15 m", "50 m", "100 m", "150 m"], answer: "150 m", topic: "GLB (Perhitungan)" }, 
        { q: "Sebuah mobil dari diam mencapai kecepatan 10 m/s dalam 5 s. Berapa percepatannya (Rumus a=(Vt-V0)/t)?", options: ["1 m/s¬≤", "2 m/s¬≤", "5 m/s¬≤", "10 m/s¬≤"], answer: "2 m/s¬≤", topic: "GLBB (Perhitungan)" }, 
        { q: "Sebuah batu dilempar vertikal ke atas. Pada saat mencapai titik tertinggi, percepatannya adalah...", options: ["Nol", "Maksimum", "Sama dengan g ke atas", "Sama dengan g ke bawah"], answer: "Sama dengan g ke bawah", topic: "Gerak & Gaya (Konsep)" }, 
        { q: "Jika sebuah benda memiliki massa 5 kg dan bergerak dengan percepatan 2 m/s¬≤, berapa gaya (Rumus F=m x a) yang bekerja padanya?", options: ["5 N", "10 N", "20 N", "50 N"], answer: "10 N", topic: "Hukum Newton (Perhitungan)" }, 
        { q: "Pada gerak GLBB diperlambat, grafik kecepatan terhadap waktu akan membentuk...", options: ["Garis lurus naik", "Garis lurus horizontal", "Garis lurus turun", "Kurva parabola"], answer: "Garis lurus turun", topic: "GLBB (Konsep)" },
        { q: "Perhatikan rumus Vt = V0 + a x t. Rumus ini digunakan untuk gerak...", options: ["GLB", "GLBB", "Gerak Melingkar", "Hukum Pascal"], answer: "GLBB", topic: "GLBB (Konsep)" },
        { q: "Apabila gaya gesek lebih besar daripada gaya dorong, maka benda...", options: ["Bergerak dipercepat", "Bergerak konstan", "Bergeser sedikit", "Tetap diam"], answer: "Tetap diam", topic: "Gaya (Konsep)" },
        { q: "Buah kelapa 1 kg berada 10 m di atas tanah (g=10 m/s¬≤). Berapa Ep nya?", options: ["1 J", "10 J", "100 J", "200 J"], answer: "100 J", topic: "Energi Potensial (Perhitungan)" }, 
        { q: "Seorang anak mendorong balok dengan gaya 50 N sejauh 4 m. Berapa Usaha yang dilakukan?", options: ["20 J", "100 J", "200 J", "500 J"], answer: "200 J", topic: "Usaha (Perhitungan)" }, 
        { q: "Sebuah mobil 1000 kg bergerak 20 m/s. Berapakah Ek mobil tersebut?", options: ["20.000 J", "100.000 J", "200.000 J", "400.000 J"], answer: "200.000 J", topic: "Energi Kinetik (Perhitungan)" }, 
    ];

    // Variabel global
    let questions = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let wrongAnswers = [];
    let horseProgressPercent = 0; 
    const totalQuestions = originalQuestions.length; 
    
    // MAKSIMUM PROGRESS DIKURANGI SEDIKIT AGAR KUDA TIDAK KELUAR DARI GARIS FINISH
    const maxProgress = 98; 
    // Persentase kenaikan per soal dihitung berdasarkan totalQuestions dan maxProgress
    let stepScorePercent = maxProgress / totalQuestions; 

    // Fungsi pengacak Fisher-Yates
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // --- FUNGSI CONFETTI (Tidak diubah) ---
    const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722'];
    function launchConfetti() {
        const confettiCount = 100;
        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            const x = Math.random() * window.innerWidth - (window.innerWidth / 2) + 'px';
            const y = Math.random() * window.innerHeight * 0.2 - window.innerHeight * 0.25 + 'px';
            const rotation = Math.random() * 360 + 'deg';
            confetti.style.setProperty('--x', x);
            confetti.style.setProperty('--y', y);
            confetti.style.setProperty('--rotation', rotation);
            confetti.style.left = Math.random() * 100 + 'vw';
            document.body.appendChild(confetti);
            setTimeout(() => { confetti.remove(); }, 3000);
        }
    }
    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText += `
        @keyframes smallFall {
            0% { opacity: 1; transform: translate(0, 0) rotate(0deg); }
            100% { opacity: 0; transform: translate(var(--x), var(--y)) rotate(360deg); }
        }
    `;
    document.head.appendChild(styleSheet);
    
    function launchSmallConfetti(rect, colors, count) {
        for (let i = 0; i < count; i++) {
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            const startX = rect.left + rect.width / 2;
            const startY = rect.top + rect.height / 2;
            
            confetti.style.left = startX + 'px';
            confetti.style.top = startY + 'px';
            
            confetti.style.animationName = 'smallFall';
            confetti.style.animationDuration = '1.5s';
            
            const angle = Math.random() * Math.PI * 2;
            const distance = Math.random() * 80 + 20;
            const finalX = distance * Math.cos(angle) + 'px';
            const finalY = distance * Math.sin(angle) + 'px';

            confetti.style.setProperty('--x', finalX);
            confetti.style.setProperty('--y', finalY);

            document.body.appendChild(confetti);

            setTimeout(() => { confetti.remove(); }, 1500);
        }
    }
    // --- AKHIR FUNGSI CONFETTI ---


    function renderInputScreen() {
        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="flex items-center justify-center w-full h-full p-8 bg-gray-900">
                <div class="p-10 bg-white rounded-xl shadow-2xl w-full max-w-xl text-center border-t-8 border-indigo-600 transform hover:scale-[1.02] transition duration-500">
                    <h1 class="text-4xl font-black text-indigo-700 mb-4">Game Pacuan Kuda IPA Kelas 8 üêé</h1>
                    <p class="mb-6 text-gray-600 font-medium text-lg">Review Materi IPA Kelas 8: Kalor, Usaha & Energi, Gerak & Gaya. Total ${totalQuestions} Soal (Diacak).</p>

                    <!-- INFO GAME -->
                    <div class="text-left mb-6 p-4 bg-yellow-100 border border-yellow-300 rounded-lg">
                        <h3 class="text-xl font-bold text-yellow-700 mb-2">Aturan Main:</h3>
                        <ul class="list-disc list-inside text-base text-gray-700 space-y-1">
                            <li>Jawaban Benar: Kuda bergerak **maju 1 langkah**.</li>
                            <li>Jawaban Salah: Kuda bergerak **mundur 1 langkah** & Soal dicatat.</li>
                            <li>Tujuan: Capai garis finish!</li>
                        </ul>
                    </div>

                    <div class="space-y-4">
                        <input type="text" id="studentName" placeholder="Tulis Nama Siswa" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-xl font-medium" required>
                        <input type="text" id="studentClass" placeholder="Tulis Kelas (misalnya: 8A)" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-xl font-medium" required>
                    </div>
                    <button onclick="startGame()" class="mt-8 w-full bg-green-600 text-white font-black py-4 rounded-xl hover:bg-green-700 transition duration-300 text-2xl shadow-lg transform hover:scale-105">
                        Mulai Pacuan!
                    </button>
                </div>
            </div>
        `;
    }

    function startGame() {
        const name = document.getElementById('studentName').value.trim();
        const className = document.getElementById('studentClass').value.trim();

        if (name && className) {
            sessionStorage.setItem('studentName', name);
            sessionStorage.setItem('studentClass', className);
            
            questions = [...originalQuestions];
            shuffleArray(questions);
            
            currentQuestionIndex = 0;
            score = 0;
            wrongAnswers = [];
            horseProgressPercent = 0; // Reset posisi kuda ke 0%
            renderQuiz();
        } else {
            const errorMsg = document.createElement('p');
            errorMsg.textContent = 'Nama dan Kelas wajib diisi!';
            errorMsg.className = 'text-red-500 font-bold mt-3';
            const container = document.querySelector('.space-y-4');
            container.parentNode.insertBefore(errorMsg, container.nextSibling);
            setTimeout(() => errorMsg.remove(), 2000);
        }
    }

    function renderQuiz() {
        // Kuda dianggap mencapai finish jika progress >= maxProgress (98%)
        if (horseProgressPercent >= maxProgress) {
             renderResultScreen();
             return;
        }

        if (currentQuestionIndex >= questions.length) {
            renderResultScreen();
            return;
        }

        const name = sessionStorage.getItem('studentName');
        const className = sessionStorage.getItem('studentClass');
        const qData = questions[currentQuestionIndex];
        const questionNumber = currentQuestionIndex + 1;
        const app = document.getElementById('app');
        
        // Skor display dibulatkan ke 100% jika sudah mencapai batas
        const displayScore = Math.min(100, Math.round((horseProgressPercent / maxProgress) * 100)); 

        app.innerHTML = `
            <!-- Header Status Bar -->
            <div class="flex-shrink-0 flex justify-between items-center p-4 bg-gray-900 text-white shadow-xl border-b-4 border-yellow-500">
                <div class="text-base font-medium">
                    <p>Siswa: <span class="font-bold text-yellow-300">${name} - ${className}</span></p>
                </div>
                <div class="text-right flex items-center space-x-6">
                    <p class="text-xl font-medium">Soal: <span class="font-extrabold text-3xl text-indigo-400">${questionNumber} / ${totalQuestions}</span></p>
                    <p class="text-xl font-medium">Progres: <span class="font-extrabold text-3xl text-green-400">${displayScore}%</span></p>
                </div>
            </div>

            <!-- Main Content: Quiz (65%) & Game (35%) -->
            <div class="quiz-main-layout">
                <!-- QUIZ AREA (Kiri/Fokus) -->
                <div class="quiz-area-wrapper">
                    <div id="quiz-area">
                        <h2 class="text-xl font-black text-gray-800 mb-6 bg-indigo-100 p-3 rounded-lg inline-block border-b-4 border-indigo-400">
                            Soal #${questionNumber} (${qData.topic})
                        </h2>
                        
                        <!-- Soal lebih besar dan fokus di tengah -->
                        <p class="text-4xl text-gray-900 mb-10 font-extrabold leading-tight text-center">
                            ${qData.q}
                        </p>
                        
                        <!-- Opsi Jawaban -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${qData.options.map((option, index) => `
                                <button id="option-${index}"
                                    class="quiz-option p-5 font-medium rounded-xl text-left shadow-lg transform transition-all duration-200"
                                    onclick="checkAnswer(this, '${option.replace(/'/g, "\\'")}', '${qData.answer.replace(/'/g, "\\'")}')">
                                    <span class="font-black mr-2">${String.fromCharCode(65 + index)}.</span> ${option}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- GAME AREA (Kanan/Visual) -->
                <div class="game-area-wrapper">
                    <div class="text-center w-full mb-4">
                        <h3 class="text-3xl font-black text-green-900 uppercase">PACUAN KUDA FISIKA</h3>
                        <p class="text-sm text-green-700">Ayo Jawab Benar Agar Kudamu Menang! ü•á</p>
                    </div>

                    <!-- LINTASAN PACUAN KUDA -->
                    <div class="race-track-container" id="race-track-container">
                        <!-- Garis Start -->
                        <div class="start-line"></div>
                        <!-- Garis Finish -->
                        <div class="finish-line"></div>
                        
                        <!-- Kuda Pemain -->
                        <!-- Posisi left diset berdasarkan horseProgressPercent -->
                        <div id="horse-racer" class="horse-racer" style="left: ${horseProgressPercent}%;">
                            üêé
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // Fungsi untuk membuat penundaan (delay)
    const delay = ms => new Promise(res => setTimeout(res, ms));

    async function checkAnswer(button, selectedOption, correctAnswer) {
        document.querySelectorAll('.quiz-option').forEach(btn => btn.disabled = true);

        const horseRacer = document.getElementById('horse-racer');

        if (selectedOption === correctAnswer) {
            // Jawaban Benar: Kuda bergerak maju 1 langkah
            button.classList.add('option-correct');
            
            // Logika MAJU: Gunakan Math.min untuk memastikan tidak melebihi maxProgress
            horseProgressPercent = Math.min(horseProgressPercent + stepScorePercent, maxProgress);
            
            const confettiColors = ['#fff176', '#a5d6a7', '#64b5f6'];
            launchSmallConfetti(button.getBoundingClientRect(), confettiColors, 30); 

        } else {
            // Jawaban Salah: Kuda bergerak mundur 1 langkah
            button.classList.add('option-wrong');
            wrongAnswers.push(questions[currentQuestionIndex].q); 

            // Highlight jawaban yang benar
            document.querySelectorAll('.quiz-option').forEach(btn => {
                const optionText = btn.innerText.substring(3).trim(); 
                if (optionText === correctAnswer) {
                    btn.classList.add('bg-green-300', 'text-green-900', 'border-2', 'border-green-700', 'shadow-xl');
                }
            });

            // Logika MUNDUR: Gunakan Math.max untuk memastikan tidak kurang dari 0%
            horseProgressPercent = Math.max(horseProgressPercent - stepScorePercent, 0); 
        }

        // Terapkan posisi baru kuda (style.left)
        if (horseRacer) {
            horseRacer.style.left = `${horseProgressPercent}%`;
        }

        await delay(2000); 
        currentQuestionIndex++;
        renderQuiz();
    }
    
    function renderResultScreen() {
        // Ambil hasil akhir dari 100%
        const finalProgress = Math.min(100, Math.round((horseProgressPercent / maxProgress) * 100));
        const name = sessionStorage.getItem('studentName');
        const className = sessionStorage.getItem('studentClass');
        // Menang jika mencapai 95% atau lebih dari progress penuh (maxProgress)
        const isPassed = horseProgressPercent >= (maxProgress * 0.95); 

        const app = document.getElementById('app');
        app.innerHTML = `
            <div class="flex items-center justify-center w-full h-full p-8 bg-gray-900">
                <div class="p-10 bg-white rounded-xl shadow-2xl w-full max-w-2xl text-center border-t-8 ${isPassed ? 'border-green-600' : 'border-red-600'}">
                    <h1 class="text-4xl font-extrabold mb-4 ${isPassed ? 'text-green-700' : 'text-red-700'}">
                        ${isPassed ? 'SELAMAT! KUDA ANDA MENANG PACUAN! üèÜ' : 'KUDA ANDA KELELAHAN! PERLU LATIHAN! üê¥'}
                    </h1>
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Laporan Akhir Game ${name}</h2>
                    
                    <div class="mb-8 p-6 bg-indigo-50 border border-indigo-200 rounded-xl space-y-3 shadow-inner">
                        <p class="text-lg">Siswa: <span class="font-bold text-indigo-700">${name}</span></p>
                        <p class="text-lg">Kelas: <span class="font-bold text-indigo-700">${className}</span></p>
                        <hr class="border-indigo-300 my-3">
                        <p class="text-xl">Total Jawaban Benar: <span class="font-black text-green-600">${totalQuestions - wrongAnswers.length} / ${totalQuestions}</span></p>
                        <p class="text-xl">Total Jawaban Salah: <span class="font-black text-red-600">${wrongAnswers.length}</span></p>
                        <p class="text-6xl font-black mt-6 ${isPassed ? 'text-green-700' : 'text-red-700'}">PROGRES AKHIR: ${finalProgress}%</p>
                    </div>

                    <div class="text-left mb-6 p-4 bg-red-100 border border-red-300 rounded-lg max-h-48 overflow-y-auto ${wrongAnswers.length === 0 ? 'hidden' : ''}">
                        <h3 class="text-xl font-bold text-red-700 mb-2">Soal yang Perlu Dipelajari Ulang:</h3>
                        <ol class="list-decimal list-inside text-sm text-gray-800 space-y-1">
                            ${wrongAnswers.map(q => `<li class="hover:bg-red-50 p-1 rounded transition duration-150">${q}</li>`).join('')}
                        </ol>
                    </div>

                    <button onclick="renderInputScreen()" class="mt-4 w-full bg-indigo-600 text-white font-black py-4 rounded-xl hover:bg-indigo-700 transition duration-300 text-xl transform hover:scale-[1.01] shadow-lg">
                        Ulangi Permainan (Balapan Baru!)
                    </button>
                </div>
            </div>
        `;

        if (isPassed) {
            launchConfetti(); 
        }
    }

    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
         renderInputScreen();
    });
</script>

</body>
</html>
